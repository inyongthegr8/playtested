---
import { type CollectionEntry } from "astro:content"
import SiteOptions from "../site.config.mjs"

export interface Props {
  post: CollectionEntry<"article">
  showImage?: boolean
  showCategory?: boolean
}

const { post, showImage = true, showCategory = true } = Astro.props
const { title, pubDate, category, description, author, thumb, score } = post.data

const formattedDate = new Intl.DateTimeFormat("en-US", {
  year: "numeric",
  month: "long",
  day: "numeric",
}).format(pubDate)
---

<li class="flex flex-row gap-6 py-4 border-b border-gray-100 dark:border-gray-800 items-start">
  {showImage && thumb && (
    <a href={`/article/${post.slug}`} class="block shrink-0 w-56 h-32 relative post-card-thumb">
      <img
        src={thumb}
        alt={title}
        class="w-56 h-32 object-cover rounded-md border border-gray-200 dark:border-gray-700"
        loading="lazy"
      />
      {score && (
        <div class={`score-badge ${
          score >= 9 ? 'score-green' :
          score >= 7 ? 'score-yellow' :
          'score-red'
        }`}>
          {score}/10
        </div>
      )}
    </a>
  )}

  <div class="flex-1 flex flex-col min-w-0">
    <div class="flex items-center justify-between gap-2">
      <a href={`/article/${post.slug}`} class="text-xl font-medium hover:underline truncate flex-1">
        {title}
        {SiteOptions.showAuthorsOnHomePage && author && (
          <span class="text-sm text-gray-500 dark:text-gray-400 ml-2">
            by {author}
          </span>
        )}
      </a>
      {showCategory && category && (
        <span class="ml-2 inline-block text-xs bg-gray-100 text-gray-600 dark:bg-slate-700 dark:text-slate-300 px-2 py-1 rounded max-w-[120px] truncate whitespace-nowrap">
          {category}
        </span>
      )}
    </div>
    {description && (
      <p class="text-sm text-gray-500 dark:text-gray-400 mt-1 line-clamp-2">
        {description}
      </p>
    )}
    <span class="text-xs text-gray-400 dark:text-gray-500 mt-2">{formattedDate}</span>
  </div>
</li>
